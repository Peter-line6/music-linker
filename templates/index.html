<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tableau de Bord</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; background-color: #f0f2f5; padding: 20px;}
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: relative; }
        input[type="text"] { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1em; }
        button { padding: 12px 20px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;}
        h1, h2 { border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 30px;}
        .logout-link { position: absolute; top: 20px; right: 20px; font-size: 0.9em; text-decoration: none; color: #65676b; }
        table { width: 100%; border-collapse: collapse; margin-top: 30px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; vertical-align: middle; }
        th { background-color: #f9f9f9; }
        td img { width: 40px; height: 40px; border-radius: 4px; display: block; }
        .pagination { margin-top: 30px; text-align: center; }
        .pagination a { margin: 0 10px; text-decoration: none; color: #007bff; }
        .pagination span { margin: 0 10px; color: #999; }
        
        /* NOUVEAUX STYLES */
        td a img:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }
        .copy-cell {
    cursor: pointer;
    /* NOUVEAU : Ajout de la transition pour un effet fluide */
    transition: background-color 0.2s ease-in-out;
}
.copy-cell:hover {
    background-color: #f9f9f9;
}
/* NOUVEAU : Style de la cellule une fois copiée */
.copy-cell.copied {
    background-color: #d4edda; /* Un vert pastel de confirmation */
}
    </style>
</head>
<body>
    <div class="container">
        <a href="{{ url_for('logout') }}" class="logout-link">Se déconnecter</a>
        <h1>Tableau de Bord</h1>

        <h2>Créer un nouveau lien</h2>
        <form action="{{ url_for('creer_page_lien') }}" method="post">
            <div class="form-group">
                <label for="url_input">URL de départ</label>
                <input type="text" id="url_input" name="spotify_url" size="50" placeholder="Collez une URL (morceau, album, artiste)..." required>
            </div>
            <button type="submit">Chercher les liens</button>
        </form>

        <hr style="margin-top: 40px; border: none; border-top: 1px solid #eee;">

        <h2>Liens Existants</h2>
        <table>
            <thead>
                <tr>
                    <th>Pochette</th>
                    <th>Titre / Artiste</th>
                    <th>Type</th>
                    <th>Slug</th>
                </tr>
            </thead>
            <tbody>
                {% for link in links.items %}
                <tr>
                    <td>
                        {% if link.album_cover_url %}
                            <a href="{{ url_for('page_edition', slug=link.slug) }}" title="Éditer ce lien">
                                <img src="{{ link.album_cover_url }}" alt="Pochette">
                            </a>
                        {% endif %}
                    </td>
                    <td class="copy-cell" data-url="{{ url_for('public_home', _external=True) }}{{ link.slug }}" title="Cliquer pour copier l'URL">
                        <strong>{{ link.track_name }}</strong><br><small>{{ link.artist_name }}</small>
                    </td>
                    <td>{{ link.item_type }}</td>
                    <td><a href="{{ url_for('page_publique', slug=link.slug) }}" target="_blank">/{{ link.slug }}</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="pagination">
            {% if links.has_prev %}
                <a href="{{ url_for('admin_dashboard', page=links.prev_num) }}">&laquo; Page Précédente</a>
            {% else %}
                <span>&laquo; Page Précédente</span>
            {% endif %}
            <span>Page {{ links.page }} sur {{ links.pages }}</span>
            {% if links.has_next %}
                <a href="{{ url_for('admin_dashboard', page=links.next_num) }}">Page Suivante &raquo;</a>
            {% else %}
                <span>Page Suivante &raquo;</span>
            {% endif %}
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const copyCells = document.querySelectorAll('.copy-cell');

        copyCells.forEach(cell => {
            cell.addEventListener('click', function() {
                const urlToCopy = this.dataset.url;
                navigator.clipboard.writeText(urlToCopy).then(() => {
                    // On ajoute une classe CSS pour l'effet visuel
                    this.classList.add('copied');

                    // On retire la classe après 0.5 seconde
                    setTimeout(() => {
                        this.classList.remove('copied');
                    }, 500);
                }).catch(err => {
                    console.error('Erreur lors de la copie: ', err);
                });
            });
        });
    });
</script>
</body>
</html>